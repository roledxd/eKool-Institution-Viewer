var eksLogo="https://raw.githubusercontent.com/roledxd/eKoolSploit/master/eKoolSploitLogoPNG.png",eKSEV={currentGroupId:null,currentGroupObj:null,currentEmployees:null,schoolslist:function(){var a=null;for(ccachePH.getInstitutionsList(function(b){a=b});null!==a;)return a},viewerHtml:function(){var a=eKSEV.currentGroupObj.groupData,b=eksLogo;return b=null!==a.logoImgFn?eKSEV.genEkoolFilesLink(a.logoImgFn):eksLogo,'<div> <h3 class="modalDialogTitle">eKSEV - '+a.name+'</h3> <span class="avatar FL ML20 MR30 RC3 iPersonLogoImg prof"><img src="'+b+'"></img></span> <ul class="edit leftLabels labelsInBold FL W350"> <li class="FWB"> <label id="eKSEV_schoolname">'+a.name+"("+a.id+')</label> </li><li> <label></label> </li><li> <div class="row" id="eKSEV_ehisId">EhisId: '+a.ehisId+'</div></li></ul> </div><div class="clearer"></div><div class="MT20 FWB"> <button type="button" class="g-button col-xs-4 DIB RC0" onclick="eKSEV.tabs.schoolData();">\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u0440\u0443\u043F\u043F\u044B</button> <button type="button" class="g-button col-xs-4 DIB BL0 BR0 RC0" id="personalViewBtn" onclick="eKSEV.tabs.employees();">\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u043B</button> <button type="button" class="g-button col-xs-4 DIB RC0" onclick="eKSEV.tabs.other();">\u0414\u0440\u0443\u0433\u043E\u0435</button></div><table id="updateableregionSchoolCardEventsTable" class="fulltable withInnerColumnBorders withBottomRowBorder POSREL" border="0" cellspacing="0"> <tbody id="viewerFrame3"> <tr class="nocontent"> <td id="content_title" colspan="2" class="PT30 PB30"> <div id="eKSEV_content">... '+a.name+"...</div></td></tr></tbody> </table>"},hubHtml:function(){var a="<h4>You can also load a group by visiting it's page. Here you will see a button of last group you have visited.</h4>";return"undefined"!=typeof gmainv2PH&&null!==gmainv2PH.groupId&&null!==gmainv2PH.groupObj&&(a='<h4>OR</h4><button type="button" id="eKSEVLOADCURRENT" class="g-button col-xs-7 DIB RC0 selected" onclick="eKSEV.updateHubGroupInfo('+gmainv2PH.groupId+');eKSEV.openViewer();">Use current ('+gmainv2PH.groupObj.groupData.name+")</button>"),'<div><h3 class="modalDialogTitle">eKSEV</h3><span class="avatar FL ML20 MR30 RC3 iPersonLogoImg prof"> <img id="groupImage" src="'+eksLogo+'"></span> <ul class="edit leftLabels labelsInBold FL W350"><form><h4>Load by GroupId:</h4><input type="text" id="groupIdInput" onkeyup="eKSEV.groupIdInputChanged();" name="groupIdInput">'+a+'</form></ul> </div><div class="clearer"></div><div class="MT20 FWB"><button type="button" disabled=true id="eKSEVLOAD" class="g-button col-xs-12 DIB RC0 selected" onclick="eKSEV.openViewer();">Load</button></div> <table id="updateableregionSchoolCardEventsTable" class="fulltable withInnerColumnBorders withBottomRowBorder POSREL" border="0" cellspacing="0"><tbody id="viewerFrame3"><tr class="nocontent"><td colspan="3" class="PT30 PB30"><div id="schoolNameById">No Group Selected</div></td></tr></tbody></table>'},tabs:{schoolData:async function(){document.getElementById("eKSEV_content").innerHTML=null,document.getElementById("content_title").innerHTML="\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u0440\u0443\u043F\u043F\u044B<hr><div id='eKSEV_content'></div>",document.getElementById("eKSEV_content").style.overflowY="scroll",document.getElementById("eKSEV_content").style.height="auto",document.getElementById("eKSEV_content").style.maxHeight="400px",await eKSEV.addSchoolInfoToTab()},employees:async function(){document.getElementById("eKSEV_content").innerHTML=null,document.getElementById("content_title").innerHTML="\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u043B<hr><div id='eKSEV_content'></div>",document.getElementById("eKSEV_content").style.overflowY="scroll",document.getElementById("eKSEV_content").style.height="auto",document.getElementById("eKSEV_content").style.maxHeight="400px",await eKSEV.addEmployeesToTab()},other:async function(){document.getElementById("eKSEV_content").innerHTML=null,document.getElementById("content_title").innerHTML="\u0414\u0440\u0443\u0433\u043E\u0435<hr><div id='eKSEV_content'></div>",document.getElementById("eKSEV_content").style.overflowY="scroll",document.getElementById("eKSEV_content").style.height="auto",document.getElementById("eKSEV_content").style.maxHeight="400px",document.getElementById("eKSEV_content").innerHTML+=schoolTable}},addSchoolInfoToTab:async function(){var a=eKSEV.generateSchoolDiv();document.getElementById("eKSEV_content").innerHTML+=a},generateSchoolDiv:function(){var c=eKSEV.currentGroupObj,a=c.groupData;if(null!=c){var b="";return isNaN(a.ehisId)||null===a.ehisId||(b+=eKSEV.genTableInner("EHIS ID",'<a target="_blank" href="https://enda.ehis.ee/avalik/avalik/oppeasutus/OppeasutusKuva.faces?id='+a.ehisId+'">'+a.ehisId+"</a>")),null!==a.url&&(b+=eKSEV.genTableInner("School URL",'<a target="_blank" href="'+a.url+'">'+a.url+"</a>")),null!==a.timetableUrl&&(b+=eKSEV.genTableInner("Timetable URL",'<a target="_blank" href="'+a.timetableUrl+'">'+a.timetableUrl+"</a>")),null!==a.creator&&(b+=eKSEV.genTableInner("Created by",a.creator)),null!==a.created&&(b+=eKSEV.genTableInner("Created at",a.created)),null!==a.email&&null!==a.email.name&&(b+=eKSEV.genTableInner("Email",'<a href="mailto:'+a.email.name+'">'+a.email.name+"</a>")),null!==a.email&&null!==a.email.created&&null!==a.email.modified&&(b+=eKSEV.genTableInner("Email (CR | MOD)",a.email.created+" | "+a.email.modified)),null!==a.email&&null!==a.email.creator&&(b+=eKSEV.genTableInner("Email Creator",a.email.creator)),null!==a.email&&null!==a.email.modifier&&(b+=eKSEV.genTableInner("Email Modifier",a.email.modifier)),b+=eKSEV.genTableInner("Group Object",'<a onclick="eKSEV.printSchoolObject();">Print to console</a>'),'<div id="schooltable_'+a.id+'" style="margin-top: 2%;"><table style="padding-left: 5px;padding-bottom:3px; font-size:10px;"><tbody id="tableBody-eksev">'+b+"</tbody></table></div>"}return"Can't load the group."},addEmployeesToTab:async function(){await eKSEV.currentEmployees.forEach(a=>{var b=eKSEV.generateProfileDiv(a);document.getElementById("eKSEV_content").innerHTML+=b})},show:function(){clayoutPH.initMMModalDialog({preferredWidth:550,hasCloseButton:!0,innerPadding:0}),$("modaldialog_content").update(eKSEV.hubHtml())},switchUserTable:function(b){var a=eKSEV.currentEmployees.find(a=>a.id===b);if(a){var c=document.getElementById("tableBtn_"+b);if(a.isTableOpen)(d=document.getElementById("usertable_"+b)).remove(),a.isTableOpen=!1,c.innerText="\u0420\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044C";else{var d=eKSEV.generateUserTableDiv(a);document.getElementById("userElement_"+b).insertAdjacentHTML("beforeend",d),a.isTableOpen=!0,c.innerText="\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C"}}},groupIdInputChanged:function(){document.getElementById("eKSEVLOAD").disabled=!0;var b=document.getElementById("groupIdInput").value;if(!isNaN(b)){var a=eKSEV.schoolslist().find(a=>a.id==b);"null"!=typeof a&& void 0!==a?eKSEV.updateHubGroupInfo(a.id):eKSEV.updateHubGroupInfo(null)}},genTableInner:function(a,b){return null!==a&&null!==b?'<tr id="tableInner_'+a+'"><th id="title"><h3 style="text-align: left;">'+a+'</h3></th><td id="value"><h3 style="text-align: left;">'+b+"</h3></td></tr>":null},generateUserTableDiv:function(a){if(null!==a){var b="";if(null!==a.userName&&(b+=eKSEV.genTableInner("Username",a.userName)),null!==a.id&&(b+=eKSEV.genTableInner("userId",a.id)),null!==a.idCode&&(null!==a.idIssuedBy?b+=eKSEV.genTableInner("idCode","["+a.idIssuedBy.isoCode+"] "+a.idCode+"<br>"+a.idIssuedBy.created):b+=eKSEV.genTableInner("idCode",a.idCode)),null!==a.created&&(b+=eKSEV.genTableInner("Creation Date",a.created)),null!==a.creator&&(b+=eKSEV.genTableInner("Created by",a.creator)),null!==a.modifier&&(b+=eKSEV.genTableInner("Modifier",a.modifier)),null!==a.birthDay&&(b+=eKSEV.genTableInner("Birthdate",a.birthDay)),null!==a.lastIp&&(b+=eKSEV.genTableInner("Last IP",a.lastIp)),null!==a.lastLogin&&(b+=eKSEV.genTableInner("Last Login",a.lastLogin)),null!==a.gender){var c=a.gender;b+=0==c?eKSEV.genTableInner("Gender","Male ("+c+")"):1==c?eKSEV.genTableInner("Gender","Female ("+c+")"):eKSEV.genTableInner("Gender","Undefined ("+c+")")}return null!==a.optLock&&(b+=eKSEV.genTableInner("Optlock",a.optLock)),null!==a.profileImgFn&&(b+=eKSEV.genTableInner("Avatar Link","<a target='_blank' href='"+eKSEV.genEkoolFilesLink(a.profileImgFn)+"'>Open in a new teb</a>")),null!==a.langCode&&(b+=eKSEV.genTableInner("Language Code",a.langCode)),b+=eKSEV.genTableInner("Actions",'<a onclick="eKSEV.printUserProfile('+a.id+')">Print to console</a><br><a onclick="eKSEV.viewprofile('+a.id+')">View profile</a>'),'<div id="usertable_'+a.id+'" style="margin-top: 2%;"><table style="padding-left: 5px;padding-bottom:3px; font-size:10px;"><tbody id="tableBody-eksev">'+b+"</tbody></table></div>"}return null},viewprofile:function(a){eKSEV.lochash("#/?screenId=g.person.show&personId="+a)},lochash:function(a){location.hash=a},printUserProfile:function(a){if(a){var b=eKSEV.currentEmployees.find(b=>b.id===a);console.log(b)}},printSchoolObject:function(){var a=eKSEV.currentGroupObj;console.log(a)},generateProfileDiv:function(a){if(null!==a){if(null!=a.profileImgFn)var c=eKSEV.genEkoolFilesLink(a.profileImgFn);else c="r/gen/a/"+chelperPH.refreshUID+"/r/img/user_icon_default.png";var d="",b="";return eKSEV.currentGroupObj.groupAdminList.find(b=>b.id===a.id)&&(d="bold",b+=' <span class="badge badge-success">Admin</span>'),eKSEV.currentGroupObj.groupTeacherList.find(b=>b.id===a.id)&&(b+=' <span class="badge badge-primary">Teacher</span>'),html='<div class="identity MT5" id="userElement_'+a.id+'"><h2 class="h1"><img src="'+c+'" class="avatar iPersonLogoImg prof MR10 POSREL" style="width:74px;height:74px;top:0px;left:0px;"><span class="iProfileName '+d+' h2">'+a.name1+" "+a.name2+" </span>"+b+'<a link id="tableBtn_'+a.id+'" onclick="eKSEV.switchUserTable('+a.id+');" style="float:right;"class="iProfileName h2">\u0420\u0430\u0441\u0448\u0438\u0440\u0438\u0442\u044C</a></h2></div><hr>'}return!1},getEmployees:function(){peopleResourceManager.getAllActiveEmployeesByInstitutionId(eKSEV.currentGroupId,{callback:function(a){eKSEV.currentEmployees=a.returnObject,eKSEV.currentEmployees.forEach(a=>{a.isTableOpen=!1}),eKSEV.currentEmployees.sort(function(a,b){return a.name1<b.name1?-1:a.name1>b.name1?1:0}),eKSEV.currentEmployees.sort(function(b,c){var a=eKSEV.currentGroupObj.groupTeacherList.find(a=>a.id===b.id);return a?-1:a?0:1}),eKSEV.currentEmployees.sort(function(b,c){var a=eKSEV.currentGroupObj.groupAdminList.find(a=>a.id===b.id);return a?-1:a?0:1}),document.getElementById("eKSEVLOAD").disabled=!1}})},genEkoolFilesLink:function(a){return"https://files.ekool.eu/"+a},updateGroupData:function(a){ccachePH.groupObj(a,!0,function(a){"object"!=a&&"undefined"!=a&&(eKSEV.currentGroupId=a.groupData.id,eKSEV.currentGroupObj=a,eKSEV.getEmployees())})},clearGroupData:function(){currentGroupId=null,currentGroupObj=null,currentEmployees=null},updateHubGroupInfo:function(a){if(document.getElementById("schoolNameById").innerText="Getting Group Data...",document.getElementById("groupImage").src=eksLogo,null==a)return document.getElementById("schoolNameById").innerText="No Group Selected",void(document.getElementById("groupImage").src=eksLogo);try{ccachePH.groupObj(a,!0,function(b){if("object"!=b&&"undefined"!=b){if(eKSEV.updateGroupData(a),null!==b.groupData.logoImgFn){var c=eKSEV.genEkoolFilesLink(b.groupData.logoImgFn);document.getElementById("groupImage").src=c}else document.getElementById("groupImage").src=eksLogo;document.getElementById("schoolNameById").innerText=b.groupData.name}else document.getElementById("schoolNameById").innerText="Invalid GroupId",document.getElementById("groupImage").src=eksLogo})}catch(b){document.getElementById("schoolNameById").innerText="Error: "+b}},openViewer:function(){null!==eKSEV.currentGroupObj?(clayoutPH.initMMModalDialog({preferredWidth:550,hasCloseButton:!0,innerPadding:0}),$("modaldialog_content").update(eKSEV.viewerHtml()),document.getElementsByClassName("ico-x_close noPrint")[0].onclick+=" eKSEV.clearGroupData();",document.getElementById("personalViewBtn").innerHTML="\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u043B ("+eKSEV.currentEmployees.length+")"):chelperPH.showError("eKSEV Error","eKSEV.currentGroupId = null")}}
